<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
		<title>d2l-input-radio-button test</title>
		<script src="../../webcomponentsjs/webcomponents-lite.js"></script>
		<script src="../../web-component-tester/browser.js"></script>
		<link rel="import" href="../../iron-test-helpers/mock-interactions.html">
		<link rel="import" href="../d2l-input-radio-button.html">
		<link rel="import" href="./d2l-input-radio-button-test-component.html">
	</head>
	<body>
		<test-fixture id="basic">
			<template>
				<d2l-input-radio-button label="basic"></d2l-input-radio-button>
			</template>
		</test-fixture>
		<test-fixture id="checked">
			<template>
				<d2l-input-radio-button checked label="checked"></d2l-input-radio-button>
			</template>
		</test-fixture>
		<test-fixture id="disabled">
			<template>
				<d2l-input-radio-button disabled label="disabled"></d2l-input-radio-button>
			</template>
		</test-fixture>
		<test-fixture id="name-value">
			<template>
				<d2l-input-radio-button name="cb-name" value="cb-value" label="name-value"></d2l-input-radio-button>
			</template>
		</test-fixture>
		<test-fixture id="group">
			<template>
				<d2l-input-radio-button-test-component></d2l-input-radio-button-test-component>
			</template>
		</test-fixture>
		<script>
			describe('d2l-input-radio-button', function() {

				var elem;

				describe('basic', function() {

					it('should instantiate the element', function() {
						elem = fixture('basic');
						expect(elem.is).to.equal('d2l-input-radio-button');
					});

				});

				describe('checked', function() {

					describe('checked-false', function() {

						beforeEach(function() {
							elem = fixture('basic');
						});

						it('should default "checked" to false', function() {
							expect(elem.checked).to.be.false;
							expect(elem.hasAttribute('checked')).to.be.false;
							expect(elem.querySelector('input').checked).to.be.false;
						});

						it('should reflect "checked" property change to input', function() {
							elem.checked = true;
							// expect(elem.hasAttribute('checked')).to.be.true;
							expect(elem.querySelector('input').checked).to.be.true;
						});

						it('should reflect "checked" attribute change to property and input', function() {
							elem.setAttribute('checked', 'checked');
							expect(elem.checked).to.be.true;
							expect(elem.querySelector('input').checked).to.be.true;
						});

						it('should reflect input "checked" change to property', function() {
							elem.querySelector('input').click();
							expect(elem.checked).to.be.true;
							// expect(elem.hasAttribute('checked')).to.be.true;
						});

					});

					describe('checked-true', function() {

						beforeEach(function() {
							elem = fixture('checked');
						});

						it('should default "checked" to true', function() {
							expect(elem.checked).to.be.true;
							expect(elem.hasAttribute('checked')).to.be.true;
							expect(elem.querySelector('input').checked).to.be.true;
						});

						it('should reflect "checked" property change to input', function() {
							elem.checked = false;
							// expect(elem.hasAttribute('checked')).to.be.false;
							expect(elem.querySelector('input').checked).to.be.false;
						});

						it('should reflect "checked" attribute change to property and input', function() {
							elem.removeAttribute('checked');
							expect(elem.checked).to.be.false;
							expect(elem.querySelector('input').checked).to.be.false;
						});
					});

					describe('checked-change-event', function() {

						beforeEach(function() {
							elem = fixture('basic');
						});

						it('should fire "change" event when input element is clicked', function(done) {
							var input = elem.querySelector('input');
							elem.addEventListener('change', function(e) {
								if (Polymer.Element || Polymer.Settings.useShadow) {
									expect(e.target).to.equal(elem);
								} else {
									expect(e.target).to.equal(input);
								}
								done();
							});
							MockInteractions.tap(input);
						});

						it('should reflect that a previously unchecked input is now checked', function(done) {
							var input = elem.querySelector('input');
							var listener = function(e) {
								expect(e.target.checked).to.equal(true);
								elem.removeEventListener('change', listener);
								done();
							}
							elem.addEventListener('change', listener);
							MockInteractions.tap(input);
						});

					});

					describe('checked-group', function() {

						beforeEach(function() {
							elem = fixture('group');
						});

						it('should uncheck grouped button when other button clicked', function() {
							var one = Polymer.dom(elem.root).querySelectorAll('d2l-input-radio-button')[0];
							var two = Polymer.dom(elem.root).querySelectorAll('d2l-input-radio-button')[1];
							expect(one.isChecked).to.be.true;
							two.querySelector('input').click();
							expect(one.isChecked).to.be.false;
							expect(two.isChecked).to.be.true;
						});
					});
				});

				describe('disabled', function() {

					describe('disabled-false', function() {

						beforeEach(function() {
							elem = fixture('basic');
						});

						it('should default "disabled" to false', function() {
							expect(elem.disabled).to.be.false;
							expect(elem.hasAttribute('disabled')).to.be.false;
							expect(elem.querySelector('input').disabled).to.be.false;
						});

						it('should reflect "disabled" property change to attribute and input', function() {
							elem.disabled = true;
							expect(elem.hasAttribute('disabled')).to.be.true;
							expect(elem.querySelector('input').disabled).to.be.true;
						});

						it('should reflect "disabled" attribute change to property and input', function() {
							elem.setAttribute('disabled', 'disabled');
							expect(elem.disabled).to.be.true;
							expect(elem.querySelector('input').disabled).to.be.true;
						});

					});

					describe('disabled-true', function() {

						beforeEach(function() {
							elem = fixture('disabled');
						});

						it('should default "disabled" to true', function() {
							expect(elem.disabled).to.be.true;
							expect(elem.hasAttribute('disabled')).to.be.true;
							expect(elem.querySelector('input').disabled).to.be.true;
						});

						it('should reflect "disabled" property change to attribute and input', function() {
							elem.disabled = false;
							expect(elem.hasAttribute('disabled')).to.be.false;
							expect(elem.querySelector('input').disabled).to.be.false;
						});

						it('should reflect "disabled" attribute change to property and input', function() {
							elem.removeAttribute('disabled');
							expect(elem.disabled).to.be.false;
							expect(elem.querySelector('input').disabled).to.be.false;
						});

					});

				});

				describe('value', function() {

					describe('default', function() {

						beforeEach(function() {
							elem = fixture('basic');
						});

						it('should default "value" to "on"', function() {
							expect(elem.value).to.equal('on');
							expect(elem.getAttribute('value')).to.equal('on');
							expect(elem.querySelector('input').value).to.equal('on');
						});

						it('should reflect "value" property change to attribute and input', function() {
							elem.value = 'new value';
							expect(elem.getAttribute('value')).to.equal('new value');
							expect(elem.querySelector('input').value).to.equal('new value');
						});

						it('should reflect "value" attribute change to property and input', function() {
							elem.setAttribute('value', 'new value');
							expect(elem.value).to.equal('new value');
							expect(elem.querySelector('input').value).to.equal('new value');
						});

					});

					describe('set', function() {

						beforeEach(function() {
							elem = fixture('name-value');
						});

						it('should default "value" to "cb-value"', function() {
							expect(elem.value).to.equal('cb-value');
							expect(elem.getAttribute('value')).to.equal('cb-value');
							expect(elem.querySelector('input').value).to.equal('cb-value');
						});

						it('should reflect "value" property change to attribute and input', function() {
							elem.value = 'new value';
							expect(elem.getAttribute('value')).to.equal('new value');
							expect(elem.querySelector('input').value).to.equal('new value');
						});

						it('should reflect "value" attribute change to property and input', function() {
							elem.setAttribute('value', 'new value');
							expect(elem.value).to.equal('new value');
							expect(elem.querySelector('input').value).to.equal('new value');
						});

					});

				});

				describe('name', function() {

					describe('default', function() {

						beforeEach(function() {
							elem = fixture('basic');
						});

						it('should default "name" to ""', function() {
							expect(elem.name).to.equal('');
							expect(elem.querySelector('input').name).to.equal('');
							expect(elem.getAttribute('name')).to.equal('');
						});

						it('should reflect "name" property change to attribute and input', function() {
							elem.name = 'new name';
							expect(elem.getAttribute('name')).to.equal('new name');
							expect(elem.querySelector('input').name).to.equal('new name');
						});

						it('should reflect "name" attribute change to property and input', function() {
							elem.setAttribute('name', 'new name');
							expect(elem.name).to.equal('new name');
							expect(elem.querySelector('input').name).to.equal('new name');
						});

					});

					describe('set', function() {

						beforeEach(function() {
							elem = fixture('name-value');
						});

						it('should default "name" to "cb-name"', function() {
							expect(elem.name).to.equal('cb-name');
							expect(elem.getAttribute('name')).to.equal('cb-name');
							expect(elem.querySelector('input').name).to.equal('cb-name');
						});

						it('should reflect "name" property change to attribute and input', function() {
							elem.name = 'new name';
							expect(elem.getAttribute('name')).to.equal('new name');
							expect(elem.querySelector('input').name).to.equal('new name');
						});

						it('should reflect "name" attribute change to property and input', function() {
							elem.setAttribute('name', 'new name');
							expect(elem.name).to.equal('new name');
							expect(elem.querySelector('input').name).to.equal('new name');
						});

					});

				});

				describe('focus management', function() {

					beforeEach(function() {
						elem = fixture('basic');
					});

					it('should fire "focus" event when input element is focussed', function(done) {
						elem.addEventListener('focus', function(e) {
							expect(e.target).to.equal(elem);
							done();
						});
						MockInteractions.focus(elem.querySelector('input'));
					});

					it('should fire "focus" event when custom element is focussed', function(done) {
						elem.addEventListener('focus', function(e) {
							expect(e.target).to.equal(elem);
							done();
						});
						MockInteractions.focus(elem);
					});

				});

			});
		</script>
	</body>
</html>
